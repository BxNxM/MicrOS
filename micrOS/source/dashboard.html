<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="black" />
    <title>microWebDashboard</title>
    <link rel="stylesheet" href="ustyle.css">
    <style>
        input {
            -webkit-appearance: none;  /* Override default CSS styles */
            appearance: none;
            width: 25%;
            height: 5px;
            background: #e7e7e7; /* Gray */
            outline: none;
        }
        input::-webkit-slider-thumb {
            -webkit-appearance: none; /* Override default look */
            appearance: none;
            width: 20px;
            height: 20px;
            background: #B0BEC5; /* LightGray */
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
    <script src="uapi.js" defer></script>
    <script src="uwidgets.js" defer></script>
</head>
<body>
    <h1> micrOS dashboard </h1>
    <!-- Container for the dynamically generated list -->
    <ul id="dynamicContent"></ul>
    <br><br><br>
    <button id="toggleDebugSection">console</button>
    <div id="debugSection" style="display: none;">
        <h2>ðŸš€ REST API</h2>
        <!-- Display api response -->
        <p id="restConsoleUrl"></p>
        <pre id="restConsoleResponse"></pre>
        <!-- Display response time in ms -->
        <p id="restConsoleTime"></p>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Init basic info from board after DOM is fully loaded

            // CONFIGURE known FE functions
            const conf_func_fe_list = ['brightness', 'toggle', 'measure'];

            // INIT DASHBOARD (load active modules -> build page)
            restAPI('modules').then(data => {
                console.log(data);
                let app_list = data['result'];
                // Handle the app_list data here
                for (const module of app_list) {
                    //console.log(module);
                    restAPI(`${module}/help`, debug=false).then(data => {
                        let module_help = data.result;
                        let matchingElements = getMatchingElements(module_help, conf_func_fe_list);
                        //console.log(matchingElements)
                        if (matchingElements.length > 0) {
                            genPage(module, matchingElements);
                        }
                    });
                }
            }).catch(error => {
                console.error(error);
            });

            // INIT DASHBOARD (load custom widget commands -> build page)
            restAPI('dashboard_be/widget_list').then(commands => {
                console.log(commands.result)
                const widget_dict=commands.result;
                for (const module in widget_dict) {
                    if (Object.hasOwnProperty.call(widget_dict, module)) {
                        const innerObject = widget_dict[module];
                        generateElement(type='h2', data=`ðŸ§¬ ${module}`);
                        // Iterate through the inner object
                        for (const func in innerObject) {
                            if (Object.hasOwnProperty.call(innerObject, func)) {
                                const api_type = innerObject[func];
                                const api_cmd = `${module}/${func}`;
                                console.log(`Gen. Type: ${api_type} Cmd: ${api_cmd}`);
                                generateElement(type=api_type, data=api_cmd);
                };};};}
            }).catch(error => {
                console.error(error);
            });
            // INIT [hidden] debug section
            document.getElementById('toggleDebugSection').addEventListener('click', function() {
                var debugSection = document.getElementById('debugSection');
                if (debugSection.style.display === 'none') {
                    debugSection.style.display = 'block';
                } else {
                    debugSection.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
